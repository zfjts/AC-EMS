<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备列表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        primary: '#2563eb',
                        secondary: '#3b82f6',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .align-middle {
                vertical-align: middle;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen font-sans">
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 py-6 shadow-md">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center text-white">自控设备全生命周期管理平台</h1>
        </div>
    </header>

    {% include 'navbar.html' %}

    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
            <h2 class="text-2xl font-semibold text-gray-800 flex items-center"><i class="fas fa-cogs mr-2 text-primary"></i>设备列表</h2>
            <div class="flex flex-wrap gap-3 w-full md:w-auto">
                <form action="/equipment/" method="get" class="relative flex-1 max-w-md w-full md:w-64">
                    <input type="text" name="search" placeholder="搜索设备名称或型号..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-300" value="{{ search or '' }}"/>
                    <button type="submit" class="absolute right-3 top-2.5 text-gray-400 hover:text-blue-600 transition-colors duration-300" title="搜索">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <a href="/equipment/create/" class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-4 rounded-md transition duration-300 flex items-center shadow-sm hover:shadow"><i class="fas fa-plus mr-2"></i>添加新设备</a>
                
                <a href="/equipment/batch/upload/" class="bg-white hover:bg-gray-50 text-primary font-medium py-2 px-4 rounded-md transition duration-300 border border-primary/30 flex items-center shadow-sm hover:shadow"><i class="fas fa-file-import mr-2"></i>批量上传</a>
                
                <a href="/equipment/template/download/" class="bg-white hover:bg-gray-50 text-primary font-medium py-2 px-4 rounded-md transition duration-300 border border-primary/30 flex items-center shadow-sm hover:shadow"><i class="fas fa-file-download mr-2"></i>模板下载</a>
                <a href="/equipment/export/" class="bg-white hover:bg-gray-50 text-primary font-medium py-2 px-4 rounded-md transition duration-300 border border-primary/30 flex items-center shadow-sm hover:shadow"><i class="fas fa-database mr-2"></i>数据导出</a>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 transition-all duration-300 hover:shadow-lg">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr class="hover:bg-primary/5 transition-colors duration-150">
                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">设备名称</th>
                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">型号</th>
                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">制造商</th>
                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">安装位置</th>
                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">状态</th>

                        <th scope="col" class="px-6 py-4 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider align-middle">操作</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-100">
                    {% for equip in equipment %}
                    <tr class="hover:bg-gray-50 transition-colors duration-150">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 text-center align-middle">{{ equip.name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center align-middle">{{ equip.model }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center align-middle">{{ equip.manufacturer }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center align-middle">{{ equip.location }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center align-middle">
                            {% if equip.status == '运行中' %}
                                <span class="px-3 py-1 inline-flex text-sm leading-5 font-medium rounded-full bg-success/10 text-success border border-success/20">{{ equip.status }}</span>
                            {% elif equip.status == '维护中' %}
                                <span class="px-3 py-1 inline-flex text-sm leading-5 font-medium rounded-full bg-warning/10 text-warning border border-warning/20">{{ equip.status }}</span>
                            {% elif equip.status == '故障' %}
                                <span class="px-3 py-1 inline-flex text-sm leading-5 font-medium rounded-full bg-danger/10 text-danger border border-danger/20">{{ equip.status }}</span>
                            {% else %}
                                <span class="px-3 py-1 inline-flex text-sm leading-5 font-medium rounded-full bg-gray-100 text-gray-600 border border-gray-200">{{ equip.status }}</span>
                            {% endif %}
                        </td>

                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium align-middle">
                            <div class="flex justify-center space-x-3">
                                <a href="/equipment/{{ equip.id }}" class="text-primary hover:text-primary/80 transition-colors duration-300 p-1 rounded-full hover:bg-primary/10" title="查看详情"><i class="fas fa-eye"></i></a>
                                <a href="/equipment/{{ equip.id }}/parameters" class="text-primary hover:text-primary/80 transition-colors duration-300 p-1 rounded-full hover:bg-primary/10" title="参数设置"><i class="fas fa-sliders-h"></i></a>
                                <a href="/equipment/{{ equip.id }}/attachments" class="text-primary hover:text-primary/80 transition-colors duration-300 p-1 rounded-full hover:bg-primary/10" title="附属设备"><i class="fas fa-paperclip"></i></a>
                                <a href="/equipment/{{ equip.id }}/edit" class="text-primary hover:text-primary/80 transition-colors duration-300 p-1 rounded-full hover:bg-primary/10" title="编辑设备"><i class="fas fa-edit"></i></a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- 分页控件 -->
        {% if total_pages > 1 %}
        <div class="mt-6 flex justify-end">
            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <!-- 上一页 -->
                <a href="/equipment/?{% if search %}search={{ search }}&{% endif %}page={{ current_page - 1 }}" title="上一页"
                   class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50
                   {% if current_page == 1 %}opacity-50 cursor-not-allowed{% endif %}">
                    <i class="fas fa-chevron-left text-xs"></i>
                </a>

                <!-- 页码 -->
                {% set start_page = current_page - 2 if current_page - 2 > 1 else 1 %}
                {% set end_page = start_page + 4 if start_page + 4 < total_pages else total_pages %}
                
                {% if start_page > 1 %}
                <a href="/equipment/?{% if search %}search={{ search }}&{% endif %}page=1" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                    1
                </a>
                {% if start_page > 2 %}
                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                    ...
                </span>
                {% endif %}
                {% endif %}
                
                {% for page_num in range(start_page, end_page + 1) %}
                <a href="/equipment/?{% if search %}search={{ search }}&{% endif %}page={{ page_num }}" 
                   class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium
                   {% if page_num == current_page %}
                   bg-primary text-white hover:bg-primary/90
                   {% else %}
                   bg-white text-gray-700 hover:bg-gray-50
                   {% endif %}">
                    {{ page_num }}
                </a>
                {% endfor %}
                
                {% if end_page < total_pages %}
                {% if end_page < total_pages - 1 %}
                <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                    ...
                </span>
                {% endif %}
                <a href="/equipment/?{% if search %}search={{ search }}&{% endif %}page={{ total_pages }}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">
                    {{ total_pages }}
                </a>
                {% endif %}

                <!-- 下一页 -->
                <a href="/equipment/?{% if search %}search={{ search }}&{% endif %}page={{ current_page + 1 }}" title="下一页"
                   class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50
                   {% if current_page == total_pages %}opacity-50 cursor-not-allowed{% endif %}">
                    <i class="fas fa-chevron-right text-xs"></i>
                </a>
            </nav>
        </div>
        {% endif %}
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>自控设备全生命周期管理平台 &copy; 2025</p>
        </div>
    </footer>

</body>
</html>